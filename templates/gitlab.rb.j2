# The URL through which GitLab will be accessed.
external_url "{{ gitlab_external_url }}"

# gitlab.yml configuration
gitlab_rails['time_zone'] = "{{ gitlab_time_zone }}"
gitlab_rails['backup_keep_time'] = {{ gitlab_backup_keep_time }}
{% if gitlab_email_enabled == true %}
gitlab_rails['gitlab_email_enabled'] = true
gitlab_rails['gitlab_email_from'] = "{{ gitlab_email_from }}"
gitlab_rails['gitlab_email_display_name'] = "{{ gitlab_email_display_name }}"
gitlab_rails['gitlab_email_reply_to'] = "{{ gitlab_email_reply_to }}"
{% if gitlab_smtp_enabled == true %}
gitlab_rails['smtp_enable'] = true
gitlab_rails['smtp_address'] = "{{ gitlab_smtp_host }}"
{% if gitlab_smtp_port is defined %}
gitlab_rails['smtp_port'] = "{{ gitlab_smtp_port }}"
{% endif %}
gitlab_rails['smtp_user'] = "{{ gitlab_smtp_user }}"
gitlab_rails['smtp_pass'] = "{{ gitlab_smtp_password }}"
{% if gitlab_smtp_authentication is defined %}
gitlab_rails['smtp_authentication'] = "{{ gitlab_smtp_authentication }}"
{% endif %}
{% if gitlab_smtp_openssl_verify_mode is defined %}
gitlab_rails['smtp_openssl_verify_mode'] = "{{ gitlab_smtp_openssl_verify_mode }}"
{% endif %}
{% if gitlab_smtp_tls is defined %}
gitlab_rails['smtp_tls'] = "{{ gitlab_smtp_tls }}"
{% endif %}
{% if gitlab_smtp_enable_starttls_auto is defined %}
gitlab_rails['smtp_enable_starttls_auto'] = "{{ gitlab_smtp_enable_starttls_auto }}"
{% endif %}
{% else %}
gitlab_rails['smtp_enable'] = false
{% endif %}
{% endif %}

# The directory where Git repositories will be stored.
git_data_dir "{{ gitlab_git_data_dir }}"

# These settings are documented in more detail at
# https://gitlab.com/gitlab-org/gitlab-ce/blob/master/config/gitlab.yml.example#L118
{% if gitlab_ldap_enabled == true %}
gitlab_rails['ldap_enabled'] = true
gitlab_rails['ldap_host'] = '{{ gitlab_ldap_host }}'
gitlab_rails['ldap_port'] = {{ gitlab_ldap_port }}
gitlab_rails['ldap_uid'] = '{{ gitlab_ldap_uid }}'
gitlab_rails['ldap_method'] = '{{ gitlab_ldap_method}}' # 'ssl' or 'plain'
gitlab_rails['ldap_bind_dn'] = '{{ gitlab_ldap_bind_dn }}'
gitlab_rails['ldap_password'] = '{{ gitlab_ldap_password }}'
gitlab_rails['ldap_allow_username_or_email_login'] = true
gitlab_rails['ldap_base'] = '{{ gitlab_ldap_base }}'
{% else %}
gitlab_rails['ldap_enabled'] = false
{% endif %}

# GitLab Nginx
## See https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/doc/settings/nginx.md
{% if gitlab_nginx_enabled == true %}
nginx['enable'] = true
{% if gitlab_nginx_listen_port is defined %}
nginx['listen_port'] = "{{ gitlab_nginx_listen_port }}"
{% endif %}
{% if gitlab_nginx_listen_https is defined %}
nginx['listen_https'] = {{ 'true' if gitlab_nginx_listen_https == true else 'false' }}
{% endif %}
{% if gitlab_custom_server_config is defined %}
nginx['custom_gitlab_server_config'] = '{{gitlab_custom_server_config}}'
{% endif %}
{% if gitlab_real_ip_trusted_addresses is defined %}
nginx['real_ip_trusted_addresses'] = ['{{ gitlab_real_ip_trusted_addresses | join("', '") }}']
{% endif %}
# Whether to redirect http to https.
nginx['redirect_http_to_https'] = {{ 'true' if (gitlab_redirect_http_to_https == true) else 'false' }}
{% if (gitlab_ssl_certificate is defined) and (ssl_certificate_key is defined) %}
nginx['ssl_certificate'] = "{{ gitlab_ssl_certificate }}"
nginx['ssl_certificate_key'] = "{{ gitlab_ssl_certificate_key }}"
{% endif %}
{% else %}
nginx['enable'] = false
{% endif %}

# To change other settings, see:
# https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/README.md#changing-gitlab-yml-settings
